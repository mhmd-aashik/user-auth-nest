# Development Dockerfile with hot reload support

FROM node:20-alpine AS development

WORKDIR /app

# Install dependencies for development
RUN apk add --no-cache \
    python3 \
    make \
    g++

# Copy package files
COPY package*.json ./
COPY prisma ./prisma/
COPY prisma.config.ts ./

# Install all dependencies (including dev)
RUN npm install

# Generate Prisma client with dummy DATABASE_URL (not needed for generation)
ENV DATABASE_URL="postgresql://dummy:dummy@localhost:5432/dummy?schema=public"
RUN npx prisma generate

# Copy source code
COPY . .

# Expose ports (app + debug)
EXPOSE 3000 9229

# Start in development mode with hot reload
CMD ["npm", "run", "start:dev"]

